--- 
title: "DEQ R Methods Encyclopedia"
author: "DEQ R Development Team"
date: "`r Sys.Date()`"
site: bookdown::bookdown_site
# output: bookdown::gitbook
documentclass: book
bibliography: [book.bib, packages.bib]
biblio-style: apalike
link-citations: yes
github-repo: openscapes/series
description: "Simple reprex of common tasks DEQ staff encounter and how to complete them with R."
split_by: "section"
---

# Background

The purpose of this book is to describe common tasks undertaken by DEQ staff and clearly outline similar methodologies in R in order to promote learning opportunities for various skill levels of R users.

This project is an example of a [bookdown](https://bookdown.org/yihui/bookdown/) report built using R and [RStudio's R Markdown](http://rmarkdown.rstudio.com/). Many authors have contributed to this effort:

* Emma Jones (emma.jones@deq.virginia.gov)
* Connor Brogan (connor.brogan@deq.virginia.gov)
* Rex Robichaux (rex.robichaux@deq.virginia.gov)
* Joe Famularo (joseph.famularo@deq.virginia.gov)

Feel free to explore different chapters to learn about specific tasks and how to complete them efficiently and transparently in R. 

## Why R?{#whyR}

**Section Contact: ([joseph.famularo\@deq.virginia.gov](mailto:joseph.famularo@deq.virginia.gov))**

```{r child = 'subchapters/01-whyR.Rmd'}
```

## Getting Started With R{#gettingStartedWithR}

**Section Contact: Joe Famularo (joseph.famularo@deq.virginia.gov)**

```{r child = 'subchapters/01-DEQ_R_Introduction.Rmd'}
```

## Want to Contribute?{#wantToContribute}

We are always looking for collaborators. All [reprex](https://reprex.tidyverse.org/articles/articles/learn-reprex.html) (reproducible examples) must be published in R markdown using the bookdown package and bookdown output style. **Contributions are not limited to R as R markdown natively utilizes many languages including python and SQL.**

To get started with bookdown, see Yihui Xie's technical references book [bookdown: Authoring Books and Technical Documents with R Markdown](https://bookdown.org/yihui/bookdown/) or watch his webinar [introducing bookdown](https://www.rstudio.com/resources/webinars/introducing-bookdown/).


<!--chapter:end:index.Rmd-->

# Query Internal Data Sources{#queryInternalDataSources}


```{r spatialAnalysis setup, include=FALSE}
```

Accessing internal DEQ data sources has been a longtime goal of many R programmers. Connecting a local R instance to raw data allows for increased automation and reduces redundant data copies on local drives. However, querying data directly from internal resources into one's local environment is a privilege and requires a number of R skills and approval from OIS. 

Database operations rely on the SQL language. Users must first familiarize themselves with the basics of database operations with SQL. The [DataCamp Introduction to SQL course](https://www.datacamp.com/courses/introduction-to-sql){target="_blank"} is a good starting point. Additionally, the [DataCarpentry SQL databases and R](https://datacarpentry.org/R-ecology-lesson/05-r-and-databases.html){target="_blank"} course provides is a good practice before seeking a direct, read-only connection to ODS (the SQLServer back end of CEDS).

After you have **demonstrated proficiency** manipulating smaller, local data sources in R, you may submit a [Special Network Access Form](https://deqnet.deq.virginia.gov/programs/admin/ois/forms/documents/Special_Network_Access_Request_Form.pdf){target="_blank"} to OIS seeking access to ODS data view using your Microsoft credentials. After OIS approval, you may access ODS from R following the connection instructions in the [Connect to ODS](#connectToODS) module. 

Alternatively, data "pinned" on the R server are available to all staff (on the internal network or VPN) without OIS authorization. Many pre-analyzed data sources are available to be pulled into your local R environment to assist with projects. See the [Connecting to R Connect (for Pinned Data)](#connectToConnectPins) module for more information on connecting your local environment to the R server to query these internal data resources. 

## Connecting to R Connect (for Pinned Data){#connectToConnectPins}

**Section Contact: Emma Jones (emma.jones@deq.virginia.gov)**

```{r child = 'subchapters/connectToConnectPins.Rmd'}
```

## Connect to ODS{#connectToODS}

**Section Contact: Emma Jones (emma.jones@deq.virginia.gov)**

```{r child = 'subchapters/connectToODS.Rmd'}
```


## Querying Data from ODS{#queryDataFromODS}

**Section Contact: Emma Jones (emma.jones@deq.virginia.gov)**

```{r child = 'subchapters/queryDataFromODS.Rmd'}
```


## Common WQM queries{#commonWQMqueries}

**Section Contact: Emma Jones (emma.jones@deq.virginia.gov)**

```{r child = 'subchapters/commonWQMqueries.Rmd'}
```

## Common Benthic queries{#commonBenthicqueries}

Coming Soon!

## Common WQA queries{#commonWQAqueries}

Coming Soon!

## Common TMDL queries{#commonTMDLqueries}

Coming Soon!


<!--chapter:end:queryInternalDataSources.Rmd-->

# Spatial Analysis {#spatialAnalysis}

```{r spatialAnalysis setup, include=FALSE}
```

R is a powerful tool for spatial analysis. Among the many benefits to using R as a GIS are the reproducibility of codified methods, which make sharing procedures and updating results after underlying data updates easy and efficient. 

There are many resources for learning how to use R for geospatial operations. A favorite is the [Geocomputation with R](https://geocompr.robinlovelace.net/){target="_blank"} online book (free) by [Robin Lovelace](https://www.robinlovelace.net/){target="_blank"}.

To familiarize yourself with common geospatial procedures in R, the following chapter has been developed by DEQ staff to help colleagues with typical geospatial tasks. This is by no means a comprehensive introduction to geospatial techniques in R. Please see other resources for more background information on underlying geospatial principles and methods in R. 

## Spatial Data from Tabular Data{#spatialDataFromTabularData}

**Section Contact: Emma Jones (emma.jones@deq.virginia.gov)**


```{r child = 'subchapters/spatialDataFromTabularData.Rmd'}
```


## Consuming GIS REST Services in R{#consumingGISRESTservices}

**Section Contact:Rex Robichaux (rex.robichaux@deq.virginia.gov)**


```{r child = 'subchapters/Consuming_GIS_REST_Services_In_R.Rmd'}
```

## Spatial Operations on GIS REST Services in R{#spatialOperationsGISRESTservices}

**Section Contact:Rex Robichaux (rex.robichaux@deq.virginia.gov)**

```{r child = 'subchapters/spatialOperationsOnGISRESTServicesInR.Rmd'}
```



## Using Spatial Datasets{#usingSpatialDatasets}

Coming Soon!

## Interactive Mapping{#interactiveMapping}

with leaflet. Coming soon!

## Watershed Delineation 

**Section Contact: Emma Jones (emma.jones@deq.virginia.gov)**

This module overviews the basics of delineating watersheds directly in your local R environment by scraping [USGS's StreamStats](https://www.usgs.gov/mission-areas/water-resources/science/streamstats-streamflow-statistics-and-spatial-analysis-tools){target="_blank"} API. General web scraping techniques are beyond the scope of this module, but the basics can be gleaned by unpacking the referenced functions.

All watersheds delineated using this technique use USGS's StreamStats delineation techniques from a 1:24k NHD. You may manually explore the tool [here](https://streamstats.usgs.gov/ss/){target="_blank"}.


```{r child = 'subchapters/watershedDelineation.Rmd'}
```

## Landcover analysis

Coming Soon

## Spatial joins

Coming Soon


<!--chapter:end:spatialAnalysis.Rmd-->

# Shiny App Pro Tips{#shinyAppHelp}

[Shiny apps](https://shiny.rstudio.com/) are interactive web based applications built in R to increase accessibility to analytical tools, workflows, and visualizations to non-R users. DEQ relies on these tools (hosted on the [internal Connect platform](https://rconnect.deq.virginia.gov/connect/)) to extend data querying, manipulation, analysis, visualization, and reporting techniques to all staff, regardless of programming experience. Complicated workflows can be programmed in R using the shiny package to develop an easy to use front end interface, all in the R language. 

Shiny apps are easy to build. Many tutorials are available, but the best starting point is to follow the [shiny tutorial](https://shiny.rstudio.com/tutorial/) by RStudio. More advanced shiny techniques employed regularly by DEQ staff to improve application responsiveness, user experience, or back end development are outlined below.



Coming soon: 

* Shiny file organization - Using functions and modules to improve code organization, how to integrate nested modules without namespace issues
* Shiny Tricks:
    + Using HTML to help reset a complex UI
    + How to integrate tool-tip HTML without calling new packages
    + Escaping characters in user inputs
* Markdown and User-Friendly Output Files:
    + readxlsx tips for formatting excel outputs
    + Markdown files with "child' sub-markdown files
    + Markdown tips in general for TinyTex and HTML

## Shiny file organization

Coming Soon!

## Shiny Tricks

Coming Soon!

## Markdown and User-Friendly Output Files

Coming Soon!

<!--chapter:end:shinyAppHelp.Rmd-->

# Best Practices{#bestPractices}


```{r bestPractices setup, include=FALSE}
```

All programming languages have certain "best practices" that should be upheld to ensure users are upholding established procedures that are deemed most effective for interaction with said programming language. R is no stranger to rules around best practices. Below are a few resources to help familiarize yourself with some common best practices for R (many of which are universal to computing environments in general). 

* [Data Carpentry Example Best Practices](https://swcarpentry.github.io/r-novice-inflammation/06-best-practices-R/)
* [USGS Water Data Example Best Practices](https://waterdata.usgs.gov/blog/intro-best-practices/)
* [R Bloggers Example Best Practices](https://www.r-bloggers.com/2018/09/r-code-best-practices/)
* [Best Coding Practices for R](https://bookdown.org/content/d1e53ac9-28ce-472f-bc2c-f499f18264a3/)
    + This is a whole book of best practices!

**The links provided are by no means comprehensive; best practices change over time and can be altered depending on use cases.** 

Here at DEQ, we have identified a few best practices that we use daily to better manage our projects and day to day interactions with the R environment. Again, **the following articles are by no means comprehensive of all best practices employed within the agency.** 

## Version Control{#versionControl}

**Section Contact: Emma Jones (emma.jones@deq.virginia.gov)**

```{r child = 'subchapters/versionControl.Rmd'}
```


<!--chapter:end:bestPractices.Rmd-->

# Miscellaeous Tips and Tricks {#miscTips}


## Regular expression and pattern matching 

**Section Contact: Connor Brogan (connor.brogan@deq.virginia.gov)**

```{r child = 'subchapters/regularExpression_noShiny.Rmd'}
```

## Non standard evaluation

## Accessing APIs from R{#accessAPIfromR}

**Section Contact: Emma Jones (emma.jones@deq.virginia.gov)**

```{r child = 'subchapters/accessingAPIsWithR.Rmd'}
```

<!--chapter:end:miscTips.Rmd-->

