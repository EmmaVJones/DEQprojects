<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>2.3 Querying Data from ODS | DEQ R Methods Encyclopedia</title>
  <meta name="description" content="Simple reprex of common tasks DEQ staff encounter and how to complete them with R." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="2.3 Querying Data from ODS | DEQ R Methods Encyclopedia" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Simple reprex of common tasks DEQ staff encounter and how to complete them with R." />
  <meta name="github-repo" content="openscapes/series" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="2.3 Querying Data from ODS | DEQ R Methods Encyclopedia" />
  
  <meta name="twitter:description" content="Simple reprex of common tasks DEQ staff encounter and how to complete them with R." />
  

<meta name="author" content="DEQ R Development Team" />


<meta name="date" content="2022-07-05" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="connectToODS.html"/>
<link rel="next" href="commonWQMqueries.html"/>
<script src="libs/header-attrs-2.6/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/htmlwidgets-1.5.1/htmlwidgets.js"></script>
<script src="libs/plotly-binding-4.9.1/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.0.0/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.0.0/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-1.49.4/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-1.49.4/plotly-latest.min.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.13/datatables.js"></script>
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/Proj4Leaflet-1.0.1/proj4-compressed.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.3/leaflet.js"></script>
<link href="libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="libs/pagedtable-1.1/js/pagedtable.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="lib/css/bootstrap.min.css" type="text/css" />
<link rel="stylesheet" href="lib/css/style.css" type="text/css" />
<link rel="stylesheet" href="lib/css/lesson.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">DEQ R Methods Encyclopedia</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Background</a>
<ul>
<li class="chapter" data-level="1.1" data-path="whyR.html"><a href="whyR.html"><i class="fa fa-check"></i><b>1.1</b> Why R?</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="whyR.html"><a href="whyR.html#accessible-open-source-software"><i class="fa fa-check"></i><b>1.1.1</b> Accessible, Open Source Software</a></li>
<li class="chapter" data-level="1.1.2" data-path="whyR.html"><a href="whyR.html#automation-and-reproducibility"><i class="fa fa-check"></i><b>1.1.2</b> Automation and Reproducibility</a></li>
<li class="chapter" data-level="1.1.3" data-path="whyR.html"><a href="whyR.html#r-products"><i class="fa fa-check"></i><b>1.1.3</b> R Products</a></li>
<li class="chapter" data-level="1.1.4" data-path="whyR.html"><a href="whyR.html#summary"><i class="fa fa-check"></i><b>1.1.4</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="gettingStartedWithR.html"><a href="gettingStartedWithR.html"><i class="fa fa-check"></i><b>1.2</b> Getting Started With R</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="gettingStartedWithR.html"><a href="gettingStartedWithR.html#downloading-r-and-rstudio"><i class="fa fa-check"></i><b>1.2.1</b> Downloading R and RStudio</a></li>
<li class="chapter" data-level="1.2.2" data-path="gettingStartedWithR.html"><a href="gettingStartedWithR.html#configuring-rstudio"><i class="fa fa-check"></i><b>1.2.2</b> Configuring RStudio</a></li>
<li class="chapter" data-level="1.2.3" data-path="gettingStartedWithR.html"><a href="gettingStartedWithR.html#downloading-packages"><i class="fa fa-check"></i><b>1.2.3</b> Downloading Packages</a></li>
<li class="chapter" data-level="1.2.4" data-path="gettingStartedWithR.html"><a href="gettingStartedWithR.html#how-to-learn-or-continue-learning-r"><i class="fa fa-check"></i><b>1.2.4</b> How to Learn (or Continue Learning) R?</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="wantToContribute.html"><a href="wantToContribute.html"><i class="fa fa-check"></i><b>1.3</b> Want to Contribute?</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="queryInternalDataSources.html"><a href="queryInternalDataSources.html"><i class="fa fa-check"></i><b>2</b> Query Internal Data Sources</a>
<ul>
<li class="chapter" data-level="2.1" data-path="connectToConnectPins.html"><a href="connectToConnectPins.html"><i class="fa fa-check"></i><b>2.1</b> Connecting to R Connect (for Pinned Data)</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="connectToConnectPins.html"><a href="connectToConnectPins.html#api-keys"><i class="fa fa-check"></i><b>2.1.1</b> API Keys</a></li>
<li class="chapter" data-level="2.1.2" data-path="connectToConnectPins.html"><a href="connectToConnectPins.html#connect-to-the-r-server"><i class="fa fa-check"></i><b>2.1.2</b> Connect to the R server</a></li>
<li class="chapter" data-level="2.1.3" data-path="connectToConnectPins.html"><a href="connectToConnectPins.html#browse-available-pins"><i class="fa fa-check"></i><b>2.1.3</b> Browse Available Pins</a></li>
<li class="chapter" data-level="2.1.4" data-path="connectToConnectPins.html"><a href="connectToConnectPins.html#access-a-pin"><i class="fa fa-check"></i><b>2.1.4</b> Access a Pin</a></li>
<li class="chapter" data-level="2.1.5" data-path="connectToConnectPins.html"><a href="connectToConnectPins.html#query-some-of-a-pin"><i class="fa fa-check"></i><b>2.1.5</b> Query (some of) a Pin</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="connectToODS.html"><a href="connectToODS.html"><i class="fa fa-check"></i><b>2.2</b> Connect to ODS</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="connectToODS.html"><a href="connectToODS.html#credentials-local-vs-remote"><i class="fa fa-check"></i><b>2.2.1</b> Credentials (Local vs Remote)</a></li>
<li class="chapter" data-level="2.2.2" data-path="connectToODS.html"><a href="connectToODS.html#required-packages"><i class="fa fa-check"></i><b>2.2.2</b> Required Packages</a></li>
<li class="chapter" data-level="2.2.3" data-path="connectToODS.html"><a href="connectToODS.html#dbi-method-for-ods-connection"><i class="fa fa-check"></i><b>2.2.3</b> DBI Method for ODS Connection</a></li>
<li class="chapter" data-level="2.2.4" data-path="connectToODS.html"><a href="connectToODS.html#pool-method-for-ods-connection"><i class="fa fa-check"></i><b>2.2.4</b> Pool Method for ODS Connection</a></li>
<li class="chapter" data-level="2.2.5" data-path="connectToODS.html"><a href="connectToODS.html#pool-method-query-data"><i class="fa fa-check"></i><b>2.2.5</b> Pool Method: Query Data</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="queryDataFromODS.html"><a href="queryDataFromODS.html"><i class="fa fa-check"></i><b>2.3</b> Querying Data from ODS</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="queryDataFromODS.html"><a href="queryDataFromODS.html#connecting-and-disconnecting-from-a-database"><i class="fa fa-check"></i><b>2.3.1</b> Connecting and Disconnecting from a Database</a></li>
<li class="chapter" data-level="2.3.2" data-path="queryDataFromODS.html"><a href="queryDataFromODS.html#data-schema"><i class="fa fa-check"></i><b>2.3.2</b> Data Schema</a></li>
<li class="chapter" data-level="2.3.3" data-path="queryDataFromODS.html"><a href="queryDataFromODS.html#data-views-interaction"><i class="fa fa-check"></i><b>2.3.3</b> Data Views Interaction</a></li>
<li class="chapter" data-level="2.3.4" data-path="queryDataFromODS.html"><a href="queryDataFromODS.html#data-update-frequency"><i class="fa fa-check"></i><b>2.3.4</b> Data Update Frequency</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="commonWQMqueries.html"><a href="commonWQMqueries.html"><i class="fa fa-check"></i><b>2.4</b> Common WQM queries</a></li>
<li class="chapter" data-level="2.5" data-path="commonBenthicqueries.html"><a href="commonBenthicqueries.html"><i class="fa fa-check"></i><b>2.5</b> Common Benthic queries</a></li>
<li class="chapter" data-level="2.6" data-path="commonWQAqueries.html"><a href="commonWQAqueries.html"><i class="fa fa-check"></i><b>2.6</b> Common WQA queries</a></li>
<li class="chapter" data-level="2.7" data-path="commonTMDLqueries.html"><a href="commonTMDLqueries.html"><i class="fa fa-check"></i><b>2.7</b> Common TMDL queries</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="spatialAnalysis.html"><a href="spatialAnalysis.html"><i class="fa fa-check"></i><b>3</b> Spatial Analysis</a>
<ul>
<li class="chapter" data-level="3.1" data-path="spatialDataFromTabularData.html"><a href="spatialDataFromTabularData.html"><i class="fa fa-check"></i><b>3.1</b> Spatial Data from Tabular Data</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="spatialDataFromTabularData.html"><a href="spatialDataFromTabularData.html#removing-spatial-information"><i class="fa fa-check"></i><b>3.1.1</b> Removing Spatial Information</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="consumingGISRESTservices.html"><a href="consumingGISRESTservices.html"><i class="fa fa-check"></i><b>3.2</b> Consuming GIS REST Services in R</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="consumingGISRESTservices.html"><a href="consumingGISRESTservices.html#gis-rest-service-data"><i class="fa fa-check"></i><b>3.2.1</b> GIS Rest Service Data</a></li>
<li class="chapter" data-level="3.2.2" data-path="consumingGISRESTservices.html"><a href="consumingGISRESTservices.html#primary-deq-rest-endpoints"><i class="fa fa-check"></i><b>3.2.2</b> Primary DEQ REST Endpoints:</a></li>
<li class="chapter" data-level="3.2.3" data-path="consumingGISRESTservices.html"><a href="consumingGISRESTservices.html#how-do-you-know-what-fieldscriteria-to-query-on"><i class="fa fa-check"></i><b>3.2.3</b> How do you know what fields/criteria to query on?</a></li>
<li class="chapter" data-level="3.2.4" data-path="consumingGISRESTservices.html"><a href="consumingGISRESTservices.html#okaylets-build-a-simple-query-and-see-it-in-r"><i class="fa fa-check"></i><b>3.2.4</b> Okay…let’s build a simple query and see it in R…</a></li>
<li class="chapter" data-level="3.2.5" data-path="consumingGISRESTservices.html"><a href="consumingGISRESTservices.html#querying-multiple-records"><i class="fa fa-check"></i><b>3.2.5</b> Querying multiple records:</a></li>
<li class="chapter" data-level="3.2.6" data-path="consumingGISRESTservices.html"><a href="consumingGISRESTservices.html#this-works-on-lines-and-polygons-as-well"><i class="fa fa-check"></i><b>3.2.6</b> This works on lines and polygons as well!:</a></li>
<li class="chapter" data-level="3.2.7" data-path="consumingGISRESTservices.html"><a href="consumingGISRESTservices.html#building-more-advanced-queries"><i class="fa fa-check"></i><b>3.2.7</b> Building more advanced queries</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="spatialOperationsGISRESTservices.html"><a href="spatialOperationsGISRESTservices.html"><i class="fa fa-check"></i><b>3.3</b> Spatial Operations on GIS REST Services in R</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="spatialOperationsGISRESTservices.html"><a href="spatialOperationsGISRESTservices.html#gis-rest-service-data-1"><i class="fa fa-check"></i><b>3.3.1</b> GIS Rest Service Data</a></li>
<li class="chapter" data-level="3.3.2" data-path="spatialOperationsGISRESTservices.html"><a href="spatialOperationsGISRESTservices.html#level-up-your-querying-game"><i class="fa fa-check"></i><b>3.3.2</b> Level Up Your Querying Game</a></li>
<li class="chapter" data-level="3.3.3" data-path="spatialOperationsGISRESTservices.html"><a href="spatialOperationsGISRESTservices.html#set-up-your-environment"><i class="fa fa-check"></i><b>3.3.3</b> Set Up Your Environment</a></li>
<li class="chapter" data-level="3.3.4" data-path="spatialOperationsGISRESTservices.html"><a href="spatialOperationsGISRESTservices.html#query-one-layer"><i class="fa fa-check"></i><b>3.3.4</b> Query One Layer</a></li>
<li class="chapter" data-level="3.3.5" data-path="spatialOperationsGISRESTservices.html"><a href="spatialOperationsGISRESTservices.html#spatially-intersect-layers"><i class="fa fa-check"></i><b>3.3.5</b> Spatially Intersect Layers</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="usingSpatialDatasets.html"><a href="usingSpatialDatasets.html"><i class="fa fa-check"></i><b>3.4</b> Using Spatial Datasets</a></li>
<li class="chapter" data-level="3.5" data-path="interactiveMapping.html"><a href="interactiveMapping.html"><i class="fa fa-check"></i><b>3.5</b> Interactive Mapping</a></li>
<li class="chapter" data-level="3.6" data-path="watershed-delineation.html"><a href="watershed-delineation.html"><i class="fa fa-check"></i><b>3.6</b> Watershed Delineation</a>
<ul>
<li class="chapter" data-level="3.6.1" data-path="watershed-delineation.html"><a href="watershed-delineation.html#single-station-delineation"><i class="fa fa-check"></i><b>3.6.1</b> Single Station Delineation</a></li>
<li class="chapter" data-level="3.6.2" data-path="watershed-delineation.html"><a href="watershed-delineation.html#multiple-station-delineation"><i class="fa fa-check"></i><b>3.6.2</b> Multiple Station Delineation</a></li>
<li class="chapter" data-level="3.6.3" data-path="watershed-delineation.html"><a href="watershed-delineation.html#qa"><i class="fa fa-check"></i><b>3.6.3</b> QA</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="landcover-analysis.html"><a href="landcover-analysis.html"><i class="fa fa-check"></i><b>3.7</b> Landcover analysis</a></li>
<li class="chapter" data-level="3.8" data-path="spatial-joins.html"><a href="spatial-joins.html"><i class="fa fa-check"></i><b>3.8</b> Spatial joins</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="shinyAppHelp.html"><a href="shinyAppHelp.html"><i class="fa fa-check"></i><b>4</b> Shiny App Pro Tips</a>
<ul>
<li class="chapter" data-level="4.1" data-path="shiny-file-organization.html"><a href="shiny-file-organization.html"><i class="fa fa-check"></i><b>4.1</b> Shiny file organization</a></li>
<li class="chapter" data-level="4.2" data-path="shiny-tricks.html"><a href="shiny-tricks.html"><i class="fa fa-check"></i><b>4.2</b> Shiny Tricks</a></li>
<li class="chapter" data-level="4.3" data-path="markdown-and-user-friendly-output-files.html"><a href="markdown-and-user-friendly-output-files.html"><i class="fa fa-check"></i><b>4.3</b> Markdown and User-Friendly Output Files</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="miscTips.html"><a href="miscTips.html"><i class="fa fa-check"></i><b>5</b> Miscellaeous Tips and Tricks</a>
<ul>
<li class="chapter" data-level="5.1" data-path="regular-expression-and-pattern-matching.html"><a href="regular-expression-and-pattern-matching.html"><i class="fa fa-check"></i><b>5.1</b> Regular expression and pattern matching</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="regular-expression-and-pattern-matching.html"><a href="regular-expression-and-pattern-matching.html#regexOverview"><i class="fa fa-check"></i><b>5.1.1</b> Example Data Overview</a></li>
<li class="chapter" data-level="5.1.2" data-path="regular-expression-and-pattern-matching.html"><a href="regular-expression-and-pattern-matching.html#regexInR"><i class="fa fa-check"></i><b>5.1.2</b> Common R Commands and How to Use Them</a></li>
<li class="chapter" data-level="5.1.3" data-path="regular-expression-and-pattern-matching.html"><a href="regular-expression-and-pattern-matching.html#regexBasics"><i class="fa fa-check"></i><b>5.1.3</b> Basic Regular Expressions</a></li>
<li class="chapter" data-level="5.1.4" data-path="regular-expression-and-pattern-matching.html"><a href="regular-expression-and-pattern-matching.html#regexCharacters"><i class="fa fa-check"></i><b>5.1.4</b> Character Classes</a></li>
<li class="chapter" data-level="5.1.5" data-path="regular-expression-and-pattern-matching.html"><a href="regular-expression-and-pattern-matching.html#regexQuantifiers"><i class="fa fa-check"></i><b>5.1.5</b> Quantifiers</a></li>
<li class="chapter" data-level="5.1.6" data-path="regular-expression-and-pattern-matching.html"><a href="regular-expression-and-pattern-matching.html#regexAnchors"><i class="fa fa-check"></i><b>5.1.6</b> Anchors</a></li>
<li class="chapter" data-level="5.1.7" data-path="regular-expression-and-pattern-matching.html"><a href="regular-expression-and-pattern-matching.html#regexExamples"><i class="fa fa-check"></i><b>5.1.7</b> Common or Useful Patterns</a></li>
<li class="chapter" data-level="5.1.8" data-path="regular-expression-and-pattern-matching.html"><a href="regular-expression-and-pattern-matching.html#regexResources"><i class="fa fa-check"></i><b>5.1.8</b> Additional Resources</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="non-standard-evaluation.html"><a href="non-standard-evaluation.html"><i class="fa fa-check"></i><b>5.2</b> Non standard evaluation</a></li>
<li class="chapter" data-level="5.3" data-path="accessAPIfromR.html"><a href="accessAPIfromR.html"><i class="fa fa-check"></i><b>5.3</b> Accessing APIs from R</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="accessAPIfromR.html"><a href="accessAPIfromR.html#what-is-an-api"><i class="fa fa-check"></i><b>5.3.1</b> What is an API</a></li>
<li class="chapter" data-level="5.3.2" data-path="accessAPIfromR.html"><a href="accessAPIfromR.html#CMCuseCase"><i class="fa fa-check"></i><b>5.3.2</b> CMC API Use Case</a></li>
<li class="chapter" data-level="5.3.3" data-path="accessAPIfromR.html"><a href="accessAPIfromR.html#required-packages-1"><i class="fa fa-check"></i><b>5.3.3</b> Required Packages</a></li>
<li class="chapter" data-level="5.3.4" data-path="accessAPIfromR.html"><a href="accessAPIfromR.html#explore-the-endpoint-in-a-browser"><i class="fa fa-check"></i><b>5.3.4</b> Explore the endpoint in a browser</a></li>
<li class="chapter" data-level="5.3.5" data-path="accessAPIfromR.html"><a href="accessAPIfromR.html#query-api-with-r"><i class="fa fa-check"></i><b>5.3.5</b> Query API with R</a></li>
<li class="chapter" data-level="5.3.6" data-path="accessAPIfromR.html"><a href="accessAPIfromR.html#example-query-cmc-api-for-assessment-uses"><i class="fa fa-check"></i><b>5.3.6</b> Example: Query CMC API for Assessment Uses</a></li>
<li class="chapter" data-level="5.3.7" data-path="accessAPIfromR.html"><a href="accessAPIfromR.html#parting-challenge"><i class="fa fa-check"></i><b>5.3.7</b> Parting Challenge</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://bookdown.org" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">DEQ R Methods Encyclopedia</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="queryDataFromODS" class="section level2" number="2.3">
<h2><span class="header-section-number">2.3</span> Querying Data from ODS</h2>
<p><strong>Section Contact: Emma Jones (<a href="mailto:emma.jones@deq.virginia.gov" class="email">emma.jones@deq.virginia.gov</a>)</strong></p>
<p>There are a few general concepts to be aware of when querying data from ODS. These include connecting and disconnecting from a database, understanding the underlying data schema, how data “Views” interact with one another, and data update frequencies. This module deals exclusively with data from the ODS production environment. Please see the <a href="connectToODS.html#connectToODS">Connect to ODS</a> section for information about the test vs production environments.</p>
<p>In an ideal world, one would practice querying data against a test environment and only query the production environment for official data retrievals. This is especially true when building automated reports or applications that could repeatedly tax the database with frequent large queries during the development process. <strong>However,</strong> due to frequency of data updates to the ODStest environment and potential schema differences, we do not encourage users to rely on data in this environment.</p>
<div id="connecting-and-disconnecting-from-a-database" class="section level3" number="2.3.1">
<h3><span class="header-section-number">2.3.1</span> Connecting and Disconnecting from a Database</h3>
<p>It is imperative to understand that each time a user connects to a database it is that user’s responsibility to disconnect from the database once they have finished their database operations. Forgotten open database connections (or “leaked connections”) unnecessarily tax a database and are poor practice as programmers. Below are example connection and disconnection statements based on how a user may connect to a database.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="queryDataFromODS.html#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Connect using the DBI library</span></span>
<span id="cb28-2"><a href="queryDataFromODS.html#cb28-2" aria-hidden="true" tabindex="-1"></a>con <span class="ot">&lt;-</span> <span class="fu">dbConnect</span>(odbc<span class="sc">::</span><span class="fu">odbc</span>(), </span>
<span id="cb28-3"><a href="queryDataFromODS.html#cb28-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">.connection_string =</span> <span class="st">&quot;driver={ODBC Driver 11 for SQL Server};server={DEQ-SQLODS-PROD,50000};database={ODS};trusted_connection=yes&quot;</span>)</span>
<span id="cb28-4"><a href="queryDataFromODS.html#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Disconnect using the DBI library</span></span>
<span id="cb28-5"><a href="queryDataFromODS.html#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="fu">dbDisconnect</span>(con)</span></code></pre></div>
<p>The <a href="connectToODS.html#connectToODS">Connect to ODS</a> article emphasizes the benefits of using the pool package to manage database connections. Besides being useful for piping and dplyr/dbplyr functionality, pool handles the closing of unused connections without requiring user input. <strong>This is very important.</strong> For more information on pooled connections, see the <a href="https://shiny.rstudio.com/articles/pool-basics.html" target="_blank">R pool package</a> and read more generally about <a href="https://www.cockroachlabs.com/blog/what-is-connection-pooling/" target="_blank">pooled database connections</a>.</p>
<div id="standalone-reportsapplications-that-query-ods" class="section level4" number="2.3.1.1">
<h4><span class="header-section-number">2.3.1.1</span> Standalone Reports/Applications that Query ODS</h4>
<p>When building any shiny application or report that queries data from ODS, it is best to use the pool package instead of opening and closing individual database connections with each query. It is also important to include a the following script to immediately close any pooled connections immediately when a user closes an application/report. Place the connection/disconnection scripts inside the global.R file of a multifile shiny app.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="queryDataFromODS.html#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pool)</span>
<span id="cb29-2"><a href="queryDataFromODS.html#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="co"># open pool connection, best stored in global.R file</span></span>
<span id="cb29-3"><a href="queryDataFromODS.html#cb29-3" aria-hidden="true" tabindex="-1"></a>pool <span class="ot">&lt;-</span> <span class="fu">dbPool</span>(</span>
<span id="cb29-4"><a href="queryDataFromODS.html#cb29-4" aria-hidden="true" tabindex="-1"></a> <span class="at">drv =</span> odbc<span class="sc">::</span><span class="fu">odbc</span>(),</span>
<span id="cb29-5"><a href="queryDataFromODS.html#cb29-5" aria-hidden="true" tabindex="-1"></a> <span class="at">Driver =</span> <span class="st">&quot;ODBC Driver 11 for SQL Server&quot;</span>,<span class="co">#&quot;SQL Server Native Client 11.0&quot;,</span></span>
<span id="cb29-6"><a href="queryDataFromODS.html#cb29-6" aria-hidden="true" tabindex="-1"></a> <span class="at">Server=</span> <span class="st">&quot;DEQ-SQLODS-PROD,50000&quot;</span>,</span>
<span id="cb29-7"><a href="queryDataFromODS.html#cb29-7" aria-hidden="true" tabindex="-1"></a> <span class="at">dbname =</span> <span class="st">&quot;ODS&quot;</span>,</span>
<span id="cb29-8"><a href="queryDataFromODS.html#cb29-8" aria-hidden="true" tabindex="-1"></a> <span class="at">trusted_connection =</span> <span class="st">&quot;yes&quot;</span></span>
<span id="cb29-9"><a href="queryDataFromODS.html#cb29-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb29-10"><a href="queryDataFromODS.html#cb29-10" aria-hidden="true" tabindex="-1"></a><span class="co"># close pool connection, best stored in global.R file</span></span>
<span id="cb29-11"><a href="queryDataFromODS.html#cb29-11" aria-hidden="true" tabindex="-1"></a><span class="fu">onStop</span>(<span class="cf">function</span>() {</span>
<span id="cb29-12"><a href="queryDataFromODS.html#cb29-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">poolClose</span>(pool)</span>
<span id="cb29-13"><a href="queryDataFromODS.html#cb29-13" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
</div>
</div>
<div id="data-schema" class="section level3" number="2.3.2">
<h3><span class="header-section-number">2.3.2</span> Data Schema</h3>
<p>ODS is divided into multiple program areas. These areas are “turned on” for certain users depending on their data needs. To request access to certain areas of ODS, you need to submit a <a href="https://deqnet.deq.virginia.gov/programs/admin/ois/forms/documents/Special_Network_Access_Request_Form.pdf" target="_blank">Special Network Access Form</a> to OIS seeking access to specific areas of ODS. Once access to one or more areas of ODS are granted, you may explore the available areas using code ( e.g. using the <a href="https://dbi.r-dbi.org/" target="_blank">DBI package</a> ) or interactively with a GUI ( e.g. using the built in GUI functionality in the RStudio IDE ).</p>
<div id="data-exporation-dbi" class="section level4" number="2.3.2.1">
<h4><span class="header-section-number">2.3.2.1</span> Data Exporation: DBI</h4>
<p>After connecting to ODS using the config information (see <a href="connectToODS.html#connectToODS">Connect to ODS</a>), the DBI::dbListTables() allows users to see what data views are available in certain areas of ODS. Depending on your data needs, you may have an extensive list of available tables. For presentation purposes, the dbListTables() results were piped into a head() call with an n argument of 20 to only show the top 20 results.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="queryDataFromODS.html#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DBI)</span>
<span id="cb30-2"><a href="queryDataFromODS.html#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="queryDataFromODS.html#cb30-3" aria-hidden="true" tabindex="-1"></a>con <span class="ot">&lt;-</span> <span class="fu">dbConnect</span>(odbc<span class="sc">::</span><span class="fu">odbc</span>(), </span>
<span id="cb30-4"><a href="queryDataFromODS.html#cb30-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">.connection_string =</span> <span class="st">&quot;driver={ODBC Driver 11 for SQL Server};server={DEQ-SQLODS-PROD,50000};database={ODS};trusted_connection=yes&quot;</span>)</span>
<span id="cb30-5"><a href="queryDataFromODS.html#cb30-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-6"><a href="queryDataFromODS.html#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="fu">dbListTables</span>(con) <span class="sc">%&gt;%</span> </span>
<span id="cb30-7"><a href="queryDataFromODS.html#cb30-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">20</span>)</span></code></pre></div>
<pre><code>##  [1] &quot;WP_WATER_PERMITS_VIEW&quot;      &quot;trace_xe_action_map&quot;       
##  [3] &quot;trace_xe_event_map&quot;         &quot;Enf_Admin_Proceed_View&quot;    
##  [5] &quot;Enf_ECM_Docs_View&quot;          &quot;Enf_enforcement_Cases_View&quot;
##  [7] &quot;Enf_Facilities_View&quot;        &quot;Enf_Respon_Parties_View&quot;   
##  [9] &quot;Enf_Settle_Details_View&quot;    &quot;CHECK_CONSTRAINTS&quot;         
## [11] &quot;COLUMN_DOMAIN_USAGE&quot;        &quot;COLUMN_PRIVILEGES&quot;         
## [13] &quot;COLUMNS&quot;                    &quot;CONSTRAINT_COLUMN_USAGE&quot;   
## [15] &quot;CONSTRAINT_TABLE_USAGE&quot;     &quot;DOMAIN_CONSTRAINTS&quot;        
## [17] &quot;DOMAINS&quot;                    &quot;KEY_COLUMN_USAGE&quot;          
## [19] &quot;PARAMETERS&quot;                 &quot;REFERENTIAL_CONSTRAINTS&quot;</code></pre>
<p>This method is good for identifying all data views available to a user with their current permissions, but it is not efficient for understanding the overall database structure, e.g. where the views referenced above exist in the ODS schema as a whole.</p>
</div>
<div id="data-exporation-rstudio-connections-pane" class="section level4" number="2.3.2.2">
<h4><span class="header-section-number">2.3.2.2</span> Data Exporation: RStudio Connections Pane</h4>
<p>The built in Connections pane is a better way to understand how the pieces of the database fit together and quickly view the top 1000 rows of a selected data view.</p>
<p>To access this feature of RStudio, click the Connections tab in the Environment pane in your IDE.</p>
<p><img src="images/ConnectionPane-01.PNG" /></p>
<p>If you have already connected to the ODS environment using the DBI package, you will automatically see this as an available option. If not, see <a href="connectToODS.html#connectToODS">Connect to ODS</a> for more information on making this connection for the first time.</p>
<p>Click on the ODS database connection to show the connection information.</p>
<p><img src="images/ConnectionPane2.PNG" width="636" /></p>
<p>Use the Connect drop down to choose how you want to connect to the database. For this example we will choose ‘R Console’ but other options are helpful for different use cases.</p>
<p><img src="images/ConnectionPane3.PNG" /></p>
<p>The available environments are displayed once the connection is made. This happens almost instantaneously.</p>
<p><img src="images/ConnectionPane4.PNG" /></p>
<p>Click on the drop down arrow next to ODS to show the database structure and what areas you have access to. Your connection may not look identical to the example.</p>
<p><img src="images/ConnectionPane5.PNG" /></p>
<p>Click on any of the areas to preview what data views are available in each area.</p>
<p><img src="images/ConnectionPane6.PNG" /></p>
<p>You can click the drop down arrow next to each data view for details on the variables within the data view as well as each data format.</p>
<p><img src="images/ConnectionPane7.PNG" /></p>
<p>Or you can click the name of the data view to open a preview of the data view (up to first 1,000 rows) in a tabular form in the Viewer Pane. Below we are looking at the first 1,000 rows of the Edas_Benthic_Master_Taxa_View.</p>
<p><img src="images/ConnectionPane8.PNG" /></p>
<p>It is important to tell R in your data query not only which data view you are querying but also the area of ODS the data view lives in. Using the pool and dbplyr packages this is very straightforward. Note the in_schema() nested function inside the tbl() function in the example below.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="queryDataFromODS.html#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb32-2"><a href="queryDataFromODS.html#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pool)</span>
<span id="cb32-3"><a href="queryDataFromODS.html#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dbplyr)</span>
<span id="cb32-4"><a href="queryDataFromODS.html#cb32-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-5"><a href="queryDataFromODS.html#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="do">## Connect to ODS production</span></span>
<span id="cb32-6"><a href="queryDataFromODS.html#cb32-6" aria-hidden="true" tabindex="-1"></a>pool <span class="ot">&lt;-</span> <span class="fu">dbPool</span>(</span>
<span id="cb32-7"><a href="queryDataFromODS.html#cb32-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">drv =</span> odbc<span class="sc">::</span><span class="fu">odbc</span>(),</span>
<span id="cb32-8"><a href="queryDataFromODS.html#cb32-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">Driver =</span> <span class="st">&quot;ODBC Driver 11 for SQL Server&quot;</span>,<span class="co">#&quot;SQL Server Native Client 11.0&quot;,</span></span>
<span id="cb32-9"><a href="queryDataFromODS.html#cb32-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">Server=</span> <span class="st">&quot;DEQ-SQLODS-PROD,50000&quot;</span>,</span>
<span id="cb32-10"><a href="queryDataFromODS.html#cb32-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">dbname =</span> <span class="st">&quot;ODS&quot;</span>,</span>
<span id="cb32-11"><a href="queryDataFromODS.html#cb32-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">trusted_connection =</span> <span class="st">&quot;yes&quot;</span></span>
<span id="cb32-12"><a href="queryDataFromODS.html#cb32-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb32-13"><a href="queryDataFromODS.html#cb32-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-14"><a href="queryDataFromODS.html#cb32-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Query the entire Edas_Benthic_Master_Taxa_View data view from  the wqm area of ODS</span></span>
<span id="cb32-15"><a href="queryDataFromODS.html#cb32-15" aria-hidden="true" tabindex="-1"></a>masterTaxaGenus <span class="ot">&lt;-</span> pool <span class="sc">%&gt;%</span> <span class="fu">tbl</span>(<span class="fu">in_schema</span>(<span class="st">&quot;wqm&quot;</span>,  <span class="st">&quot;Edas_Benthic_Master_Taxa_View&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb32-16"><a href="queryDataFromODS.html#cb32-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span>
<span id="cb32-17"><a href="queryDataFromODS.html#cb32-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-18"><a href="queryDataFromODS.html#cb32-18" aria-hidden="true" tabindex="-1"></a><span class="co"># preview the top 6 rows of the data pulled back from ODS</span></span>
<span id="cb32-19"><a href="queryDataFromODS.html#cb32-19" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(masterTaxaGenus)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 19
##   Phylum Class Subclass Order Suborder Superfamily Family Subfamily Tribe Genus
##   &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt;       &lt;chr&gt;  &lt;chr&gt;     &lt;chr&gt; &lt;chr&gt;
## 1 Arthr~ Inse~ &lt;NA&gt;     Dipt~ &lt;NA&gt;     &lt;NA&gt;        Culic~ &lt;NA&gt;      &lt;NA&gt;  Aedes
## 2 Arthr~ Inse~ &lt;NA&gt;     Odon~ Anisopt~ &lt;NA&gt;        Aeshn~ &lt;NA&gt;      &lt;NA&gt;  Aesh~
## 3 Arthr~ Inse~ &lt;NA&gt;     Cole~ &lt;NA&gt;     &lt;NA&gt;        Dytis~ Agabinae  Agab~ Agab~
## 4 Arthr~ Inse~ &lt;NA&gt;     Tric~ &lt;NA&gt;     &lt;NA&gt;        Gloss~ Agapetin~ &lt;NA&gt;  Agap~
## 5 Arthr~ Inse~ &lt;NA&gt;     Tric~ &lt;NA&gt;     &lt;NA&gt;        Seric~ &lt;NA&gt;      &lt;NA&gt;  Agar~
## 6 Arthr~ Inse~ &lt;NA&gt;     Plec~ &lt;NA&gt;     &lt;NA&gt;        Perli~ Perlinae  Perl~ Agne~
## # ... with 9 more variables: Species &lt;chr&gt;, `Final VA Family ID` &lt;chr&gt;,
## #   FinalID &lt;chr&gt;, TolVal &lt;dbl&gt;, FFG &lt;chr&gt;, Habit &lt;chr&gt;, FamFFG &lt;chr&gt;,
## #   FamTolVal &lt;dbl&gt;, FamHabit &lt;chr&gt;</code></pre>
<p>As emphasized before, it is prudent to close all database connections established using DBI (the connection method the RStudio Connections pane utilizes). To do this using the GUI, click the “Disconnect From A Connection” button highlighted in red in the picture below.</p>
<p><img src="images/ConnectionPane9.PNG" /></p>
</div>
</div>
<div id="data-views-interaction" class="section level3" number="2.3.3">
<h3><span class="header-section-number">2.3.3</span> Data Views Interaction</h3>
<p>Another component of any database schema involves how data can be efficiently combined from the various areas of the database. Generally speaking, the way we use data locally in spreadsheets is not how a database stores said data. It is the responsibility of the data query-er to link the datasets they need to make it usable. A full tour of each area of ODS is beyond the scope of these articles, but short overviews of specific ODS areas are discussed in subsequent articles. These areas include:</p>
<ul>
<li><a href="commonWQMqueries.html#commonWQMqueries">Common WQM queries</a></li>
<li><a href="commonBenthicqueries.html#commonBenthicqueries">Common Benthic queries</a></li>
<li><a href="commonWQAqueries.html#commonWQAqueries">Common WQA queries</a></li>
<li><a href="commonTMDLqueries.html#commonTMDLqueries">Common TMDL queries</a></li>
</ul>
</div>
<div id="data-update-frequency" class="section level3" number="2.3.4">
<h3><span class="header-section-number">2.3.4</span> Data Update Frequency</h3>
<p>ODS production is update nightly reflecting any data entered into CEDS the evening before. If you need data immediately after it is entered into CEDS, then CEDS is the only location users can view the data. ODStest is updated infrequently and should not be used for official data queries.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="connectToODS.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="commonWQMqueries.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": null
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["series.pdf"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
